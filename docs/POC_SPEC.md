# PoC 스펙: 두 영상 비교 시스템

## 목표

유튜브 발레 영상(기준)과 본인 촬영 영상을 비교하여,
프레임별 포즈 유사도를 계산하고 시각화한다.

## 결정 사항

| 항목 | 결정 | 비고 |
|------|------|------|
| 기준 데이터 | 유튜브 발레 영상 | 나중에 본인 촬영으로 전환 |
| 비교 방식 | 두 영상(오프라인) 비교 | 실시간 카메라는 다음 단계 |
| 첫 테스트 동작 | 그랑 바뜨망 (Grand Battement) | 관절 각도 변화 크고 측정 명확 |
| 카메라 앵글 | 자유 각도 | 정규화로 대응 필요 |

## PoC 성공 기준

1. 포즈 추론 레이턴시 < 41ms (24FPS 유지)
2. 음악 비트-포즈 타이밍 오차 측정 가능
3. 두 영상의 프레임별 Loss가 시각적으로 확인 가능

## 아키텍처

```
[영상 A: 유튜브 기준]     [영상 B: 본인 촬영]
        │                         │
        ▼                         ▼
  MediaPipe Pose             MediaPipe Pose
        │                         │
        ▼                         ▼
  프레임별 관절 좌표         프레임별 관절 좌표
  (정규화 적용)              (정규화 적용)
        │                         │
        └──────────┬──────────────┘
                   ▼
          프레임 정렬 (Alignment)
          - 시간축 동기화
          - DTW 또는 수동 시작점 지정
                   │
                   ▼
          Loss 계산 (L2 Distance)
          - 프레임별 포즈 차이
          - 구간별 누적 에러
                   │
                   ▼
          시각화 출력
          - 두 영상 나란히 + 스켈레톤 오버레이
          - 프레임별 Loss 그래프
          - 에러 높은 구간 하이라이트
```

## 핵심 기술적 도전

### 1. 자유 각도 대응 → 좌표 정규화
카메라 각도가 다르면 같은 동작도 좌표가 완전히 다르게 나옴.

**해결**: 어깨 너비(좌우 어깨 거리) 기준으로 전체 좌표를 정규화.
골반 중심을 원점으로 이동(translation) 후, 어깨 너비로 스케일링.

> 단, 자유 각도는 2D 포즈에서 근본적 한계가 있음.
> PoC에서는 "비슷한 각도"로 촬영하는 것을 권장.
> 완전한 자유 각도 대응은 3D 포즈(MediaPipe 3D 또는 별도 모델) 필요.

### 2. 시간축 정렬
두 영상의 길이와 시작점이 다를 수 있음.

**해결 (단순)**: 사용자가 시작 프레임을 수동 지정.
**해결 (자동)**: DTW(Dynamic Time Warping)로 시계열 정렬.
PoC에서는 수동 지정으로 시작.

### 3. FPS 불일치
유튜브 영상(30fps)과 본인 영상(60fps 등)의 프레임 레이트 차이.

**해결**: 모두 24fps로 리샘플링 후 비교.

## 개발 단계

### Phase 0: 환경 세팅
- Python 가상환경 구성
- MediaPipe, OpenCV, librosa, NumPy 설치
- 테스트용 유튜브 영상 다운로드

### Phase 1: 포즈 추출 파이프라인
- 영상 입력 → MediaPipe → 프레임별 관절 좌표 JSON 저장
- 좌표 정규화 로직 구현
- 24fps 리샘플링

### Phase 2: 비교 엔진
- 두 JSON 데이터 로드
- 시간축 정렬 (수동 시작점 지정)
- 프레임별 L2 Loss 계산
- 관절별 가중치 적용 (다리 동작이므로 하체 가중치 높게)

### Phase 3: 시각화
- 두 영상 나란히 재생 + 스켈레톤 오버레이
- 하단에 실시간 Loss 그래프
- 에러 임계값 초과 시 빨간색 표시

### Phase 4: 음악 동기화 (선택)
- librosa로 BPM/비트 추출
- 비트 기준 프레임 인덱스 매핑
- 비트별 Loss 집계
