# 파뢰주법 (芭蕾呪法) PoC 분석 보고서

## 1. 개요
본 보고서는 '파뢰주법' 프로젝트의 첫 번째 단계인 PoC(Proof of Concept)의 분석 결과를 종합합니다. PoC의 목표는 유튜브 발레 영상(기준)과 사용자 촬영 영상 간의 프레임별 포즈 유사도를 계산하고 시각화하여, 시스템의 핵심 아이디어를 검증하는 것이었습니다. 특히 3D 스켈레톤 데이터를 활용하여 2D 데이터의 한계를 극복하고, 음악 비트와 동작 간의 동기화를 시도했습니다.

## 2. PoC 목표 및 접근 방식
- **목표**: 참조 및 비교 영상 간의 3D 포즈 유사도 검증, 음악 BPM 동기화를 통한 비트별 동작 분석.
- **데이터 소스**: `data/sample/reference_poses_3d.json` (참조), `data/sample/compare_poses_3d.json` (비교), `data/sample/reference_grand_battement.mp4` (음악 추출).
- **기술 스택**: Python, MediaPipe (포즈 추출), librosa (음악 분석), NumPy (수치 계산), Matplotlib (시각화), FFmpeg (오디오 추출).
- **핵심 과정**:
    1.  MediaPipe를 통해 추출된 3D 월드 랜드마크(world_landmarks)를 사용.
    2.  두 포즈 데이터 간의 프레임별 L2 거리 손실(Loss) 계산. 이때, 발레 동작의 중요성을 고려하여 하체 관절에 가중치를 적용.
    3.  `librosa`를 사용하여 참조 영상에서 음악 비트(BPM)를 추출하고 이를 비디오 프레임에 매핑.
    4.  매핑된 비트 구간별로 평균 포즈 손실을 집계.
    5.  다양한 각도에서 3D 스켈레톤 오버레이, 프레임별 손실 추이, 높은 에러 구간 등을 시각화.

## 3. 주요 분석 결과 및 시각화

### 3.1. 3D 스켈레톤 비교 시각화
(생성 파일: `skeleton_3d_max_loss.png`, `skeleton_3d_min_loss.png`, `skeleton_3d_mean_loss.png`, `skeleton_3d_multiview_max.png`, `skeleton_2d_vs_3d_comparison.png`)

-   **최대/최소/평균 손실 프레임**: 시스템은 3D 공간에서 두 동작 간의 유사도가 가장 높거나 낮은 순간을 명확히 식별하고 시각화했습니다. 이는 동작의 결정적인 오류 지점(`skeleton_3d_max_loss.png`)과 정확한 구간(`skeleton_3d_min_loss.png`)을 이해하는 데 도움을 줍니다.
-   **다중 시점 분석**: `skeleton_3d_multiview_max.png`는 최대 손실 프레임에서의 포즈를 여러 각도에서 보여주며, 단일 시점에서는 놓치기 쉬운 3D 공간에서의 미묘한 차이를 드러냈습니다.
-   **2D vs 3D 비교**: `skeleton_2d_vs_3d_comparison.png`는 2D 데이터의 카메라 투영에 의한 왜곡 한계를 보여주며, 깊이 정보가 포함된 3D 분석의 필요성과 우월성을 뒷받침합니다.

### 3.2. 음악 동기화 및 비트별 손실 분석
(생성 파일: `beat_detection.png`, `beat_info.json`, `beat_wise_loss.json`, `beat_wise_loss.png`, `reference_grand_battement.wav`)

-   **비트 추출 및 매핑**: `reference_grand_battement.mp4`에서 성공적으로 음악 비트가 추출되었고, 이 비트들이 비디오 프레임에 정확히 매핑되었습니다 (`beat_detection.png` 확인). 이를 통해 `tempo_bpm: 107.67`과 같은 정보를 얻었습니다.
-   **비트별 포즈 손실**: 비트 구간별로 가중 평균 L2 손실을 집계하여 `beat_wise_loss.png`로 시각화했습니다. 이는 특정 비트에서 동작의 정확도가 평균적으로 얼마나 높은지 또는 낮은지를 보여주어, 음악적 흐름에 따른 동작의 질을 평가하는 기초 자료가 됩니다. `beat_wise_loss.json`에 상세 데이터가 저장되었습니다.

### 3.3. 프레임별 손실 및 에러 구간 시각화
(생성 파일: `frame_by_frame_loss.png`, `highlighted_error_loss.png`)

-   **프레임별 손실 추이**: `frame_by_frame_loss.png`는 전체 비디오에 걸쳐 프레임별 포즈 손실(가중 평균 L2 거리)의 변화를 보여줍니다. 이를 통해 동작의 어떤 시점에서 에러가 발생하고 회복되는지 전반적인 흐름을 파악할 수 있습니다.
-   **높은 에러 구간**: `highlighted_error_loss.png`는 평균 손실과 표준 편차를 기준으로 높은 에러가 발생한 프레임 구간을 시각적으로 강조합니다. 이는 사용자가 특정 에러 발생 지점을 즉시 식별하고 개선하는 데 유용한 정보를 제공합니다.

### 3.4. 관절별 세부 손실 분석
(생성 파일: `average_joint_losses.png`, `average_joint_losses.json`)

-   **관절별 평균 손실**: `average_joint_losses.png`는 전체 영상 시퀀스에 걸쳐 각 관절이 참조 포즈와 비교 포즈 간에 평균적으로 얼마나 차이가 있었는지를 L2 거리 기반으로 시각화합니다. 이를 통해 어떤 관절(예: 발, 무릎 등)이 동작 수행에서 가장 큰 편차를 보이는지 직관적으로 파악할 수 있습니다. `average_joint_losses.json`에 상세 데이터가 저장되었습니다.

### 3.5. 컨셉적 파뢰주법 손실 (`Loss_jubeop`) 분석
(생성 파일: `conceptual_loss_jubeop.png`, `conceptual_loss_jubeop.json`)

-   **컨셉적 `Δt_sync`**: 각 비트 구간 내에서 최소 포즈 손실을 보인 프레임의 타임스탬프와 해당 비트의 실제 타임스탬프 간의 차이를 '컨셉적 `Δt_sync`'로 정의하고 계산했습니다. 이는 '음악 클럭과 실제 동작 완성 시점의 시간차'를 단순화하여 모델링한 것입니다.
-   **통합 손실 (`Loss_jubeop`)**: `Loss_jubeop = λ1 * ||P_act - P_tar||^2 + λ2 * Δt_sync` 공식을 사용하여 비트별 통합 손실을 계산하고 시각화했습니다 (`conceptual_loss_jubeop.png`). 여기서 `||P_act - P_tar||^2`는 비트별 가중 평균 L2 손실을, `Δt_sync`는 위에서 정의한 컨셉적 값을 사용했습니다. (`λ1 = 1.0`, `λ2 = 1.0` 설정). 이는 포즈 정확도와 타이밍 정확도를 결합한 시스템의 최종 평가 지표에 대한 개념적 구현을 보여줍니다. `conceptual_loss_jubeop.json`에 상세 데이터가 저장되었습니다.

## 4. 결론 및 향후 과제
본 PoC를 통해 '파뢰주법' 시스템의 핵심 기능인 3D 포즈 비교 및 음악 동기화 기반의 동작 분석 가능성을 성공적으로 입증했습니다. 특히, 3D 데이터를 활용한 정밀한 손실 계산과 시각화는 훈련자의 동작 개선에 실질적인 피드백을 제공할 잠재력을 보여줍니다.

향후 과제는 다음과 같습니다.
-   **`Δt_sync` 정교화**: 현재의 컨셉적 `Δt_sync`는 비트 구간 내 최소 손실 프레임을 '동작 완성 시점'으로 간주한 단순화된 모델입니다. 실제 동작 완성 시점을 정교하게 감지하기 위한 이벤트 감지(Event Detection) 알고리즘 개발이 필요합니다. 이는 특정 동작의 시작, 정점, 끝을 정의하고, 음악 비트와의 시간적 일치도를 더욱 정확하게 측정하는 것을 포함합니다.
-   **통합 영상 시각화**: 현재 참조 영상에 두 스켈레톤(참조 및 비교)을 오버레이한 비디오 (`reference_video_skeletons.mp4`)는 생성되었습니다. 향후 과제로는 두 원본 비디오를 나란히 재생하면서 스켈레톤 오버레이, 프레임별 손실 그래프, 에러 하이라이트 등을 통합하여 보여주는 고급 비디오 생성 기능 구현이 필요합니다.
-   **실시간 시스템으로의 확장**: `v0.5` 단계에서 계획된 실시간 카메라 입력 처리 및 Loss 점수화 시스템으로의 확장을 위한 아키텍처 설계 및 구현.
